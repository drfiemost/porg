#!/bin/sh
# vim:ts=4:ft=sh
#-----------------------------------------------------------------------
# paco2porg - imports paco logs into a porg database.
#-----------------------------------------------------------------------
# paco2porg is part of the package porg
# For more information visit http://porg.sourceforge.net
#-----------------------------------------------------------------------

me=`basename $0`
verb=

version()	{ porg --version | sed "s@^porg@$me@"; exit 0; }

help()
{
cat << EOF
$me - imports paco logs into a porg database.

Usage:
  $me [OPTIONS]

Options:
  -h, --help           Display this usage message and exit.
  -V, --version        Display version information and exit.
  -v, --verbose        Explain what is being done.

EOF
	exit 0
}


#---------------------------------------#
# Initialize and parse the command line #
#---------------------------------------#

opt=

# Parse the command line
while [ "$1" ]; do
	case $1 in
		-v|--verbose)	verb=yes;;
		-V|--version)	version;;
		*)	help;;
	esac
	shift
done

# Process the packages

for pkg in `paco --all --verbose`; do
	[ -n "$verb" ] && echo -n "Importing package ${pkg}..."
	if ( paco --files --no-package-name $pkg | porg --log --package $pkg ); then
		[ -n "$verb" ] && echo "\tdone"
	else
		exit 1
	fi
done

exit 0
